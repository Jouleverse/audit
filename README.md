# audit

Audit scripts and their usage for monitoring Jouleverse.

## audit_network.py

Note: @deprecated æ—§å®¡è®¡è„šæœ¬audit_network.jså·²åºŸå¼ƒã€‚

ç”¨é€”ï¼šç”¨äºæ¯æ—¥å®¡è®¡Jouleverseç½‘ç»œèŠ‚ç‚¹è¿è¡Œæƒ…å†µã€‚

èŠ‚ç‚¹ç±»å‹ï¼š1) witness - è§è¯èŠ‚ç‚¹ï¼›2) miner\* - é¢„å¤‡ä¸­çš„è®°è´¦èŠ‚ç‚¹ï¼ˆå·²PoSè´¨æŠ¼ï¼ŒæœªæŠ•ç¥¨ï¼‰ï¼›3) miner - è®°è´¦èŠ‚ç‚¹ã€‚

### å®¡è®¡é¡¹ç›®

1. åŒºå—é“¾æ€»ä½“è¿è¡Œè‰¯å¥½ğŸŸ¢ä¸å¦
2. è®°è´¦èŠ‚ç‚¹enodeè¿æ¥æƒ…å†µğŸŸ© ï¼Œä»¥åŠå‡ºå—ç‡ï¼ˆ0 < block rate < 1ï¼‰âœ…
3. è§è¯èŠ‚ç‚¹enodeè¿æ¥æƒ…å†µğŸŸ© ï¼Œä»¥åŠ8501 rpcè¿é€šæ€§åŠå½“å‰åŒºå—é«˜åº¦âœ…

miner\* ç”±äºæ˜¯ä¸­é—´è¿‡æ¸¡çŠ¶æ€ï¼Œæ•…æš‚ä¸æ£€æŸ¥å‡ºå—ç‡ï¼ˆæ²¡æœ‰ï¼‰ï¼Œä¹Ÿä¸æ£€æŸ¥8501 rpcï¼ˆä¸ºå®‰å…¨èµ·è§è®°è´¦èŠ‚ç‚¹é…ç½®å…³é—­äº†rpcï¼‰ï¼Œä¹Ÿä¸ä¼šç»Ÿè®¡åˆ°ç½‘ç»œèŠ‚ç‚¹æ•°é‡ä¸­ã€‚

### ä½¿ç”¨æ–¹æ³•

1) å°†æœ¬è„šæœ¬æ”¾åˆ°è§è¯èŠ‚ç‚¹ä¸Šï¼š

```
git clone git@github.com:Jouleverse/audit.git
```

2) å®‰è£…pythonä¾èµ–åº“

```
pip install web3
```

2) è·‘ä¸€ä¸‹ä¸‹è¿°å‘½ä»¤ï¼Œè§‚å¯Ÿè¿è¡Œç»“æœæ˜¯å¦æ­£ç¡®ï¼š

```
python3 audit_network.js ~/data/mainnet/geth.ipc
```

æ³¨æ„ï¼šæ£€æŸ¥ ~/data/mainnet/geth.ipc æ˜¯å¦æœ‰è¶³å¤Ÿæƒé™è®¿é—®

3) æ‰§è¡Œ crontab -e ï¼Œæ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œå†…å®¹å‚è§ audit_network.crontab

æ³¨æ„ï¼šè¿è¡Œdockerçš„æƒé™é—®é¢˜ã€‚ç¡®ä¿å®šæ—¶ä»»åŠ¡èƒ½å¤Ÿé¡ºåˆ©æ‰§è¡Œã€‚

### æ—¥å¸¸ç»´æŠ¤

æ–°èŠ‚ç‚¹å…¥ç½‘æµç¨‹ï¼š

è¿›èŠ‚ç‚¹é¢„å¤‡ç¾¤ -> æ­å»ºèŠ‚ç‚¹ -> æŠ¥å‘Šæ­å»ºæƒ…å†µï¼Œå¤§å®¶å®¡æŸ¥ -> OKåï¼Œè®°è´¦èŠ‚ç‚¹è´¨æŠ¼ï¼Œè§è¯èŠ‚ç‚¹ä¸éœ€è¦ -> å¡«å†™èŠ‚ç‚¹ä¿¡æ¯ç™»è®°è¡¨ -> æ·»åŠ å®¡è®¡ -> è§è¯èŠ‚ç‚¹å…¥ç½‘æˆåŠŸï¼›è®°è´¦èŠ‚ç‚¹å®‰æ’èŠ‚ç‚¹æŠ•ç¥¨ï¼ŒæŠ•ç¥¨é€šè¿‡åï¼Œæ£€æŸ¥å‡ºå—æ— è¯¯ï¼Œå…¥ç½‘æˆåŠŸ

åœ¨ä¸Šè¿°æµç¨‹ä¸­ï¼Œå®¡è®¡æ·»åŠ æ˜¯ç¡®è®¤èŠ‚ç‚¹å…¥ç½‘çš„é‡è¦ä¸€æ­¥ã€‚

å®¡è®¡èŠ‚ç‚¹éœ€è¦åšçš„äº‹æƒ…æ˜¯ï¼š

1. å®¡æŸ¥èŠ‚ç‚¹æŠ¥å‘Šåˆ°èŠ‚ç‚¹ç¾¤ä¸­çš„ä¿¡æ¯ï¼Œåˆ¤æ–­å…¶èŠ‚ç‚¹è¿è¡ŒçŠ¶æ€è‰¯å¥½ï¼Œç¬¦åˆè¦æ±‚ã€‚ç¡®è®¤æ— è¯¯åï¼Œæé†’ä»–å¡«å†™èŠ‚ç‚¹ä¿¡æ¯ç™»è®°è¡¨
2. æ ¹æ®ç™»è®°ä¿¡æ¯ï¼Œå°†è¯¥èŠ‚ç‚¹æ·»åŠ åˆ°audit_network.pyè„šæœ¬ä¸­ã€‚è¯•è¿è¡Œä¸€ä¸‹ï¼Œè§‚å¯Ÿå®¡è®¡ç»“æœï¼Œç¡®è®¤èŠ‚ç‚¹æ¥å…¥æ­£å¸¸
3. crontab -e ç¼–è¾‘å®šæ—¶ä»»åŠ¡ï¼ŒæŠŠè¯¥èŠ‚ç‚¹ç™»è®°çš„emailåœ°å€æ·»åŠ åˆ°æ¯æ—¥å®¡è®¡æŠ¥å‘Šå‘é€çš„emailåˆ—è¡¨å°¾éƒ¨
4. èŠ‚ç‚¹ç¾¤å‘¨çŸ¥å¤§å®¶ï¼Œæ–°èŠ‚ç‚¹æˆåŠŸçº³å…¥å®¡è®¡æŠ¥å‘Šï¼ˆå¯å°†ç¬¬2æ­¥è¯•è¿è¡Œçš„å®¡è®¡æŠ¥å‘Šæˆªå›¾å‘ç¾¤ä¸­ï¼‰
5. æŠŠæ›´æ–°åçš„audit_network.pyå’Œaudit_network.crontab æ¨é€åˆ°github å¹¶å‘ Pull Request è¯·æ±‚åˆå¹¶åˆ°ä¸»å¹²

### TODO

- è®°å½•æ¯æ¬¡æ£€æŸ¥ç»“æœï¼ŒæŒ‰æœˆæ±‡æ€»å¯ç”¨ç‡ç™¾åˆ†æ¯”ï¼Œçº³å…¥æŠ¥å‘Šï¼Œä½œä¸ºæœåŠ¡æ°´å¹³æŒ‡æ ‡ï¼Œä¾›PoWhæ¿€åŠ±å‚è€ƒ

### Revision History

2023.10.18: 0.1 evan.j

2023.10.26: 0.1.1 evan.j + Angel witness

2023.10.28: 0.1.2 evan.j + Menger æ¯”å°”ç›– miners, - Menger witness

...

2024.1.15: 0.2.1 evan.j
- auto detect if I am the audit node
- put it to github repo audit/, open for anyone to audit

0.2.2 evan.j
- add enode infos for all nodes, and automatically addPeer if not seeing it.

...

2024.1.16: handover audit responsibility to Jeff

2024.1.24: evan.j: python rewrite using web3

